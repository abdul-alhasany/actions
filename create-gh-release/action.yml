name: Tag and publish release
description: Create a new Git tag and publish a release on GitHub whenever the npm package version has changed.
inputs:
  GITHUB_TOKEN:
    description: GitHub token
runs:
  using: composite
  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Create tag on NPM package version change
      uses: abdul-alhasany/actions/create-tag@main
      id: tag

    - name: Setup pnpm and install dependencies
      if: steps.tag.outputs.tag-created == 'true'
      uses: pnpm/action-setup@v4
      with:
        version: latest

    - name: Publish release on GitHub
      run: pnpx changelogithub
      if: steps.tag.outputs.tag-created == 'true'
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.GITHUB_TOKEN }}

    - name: Show log message
      shell: bash
      run: echo "Release published successfully"
      if: steps.tag.outputs.tag-created == 'true'

    - name: Show log message
      shell: bash
      run: echo "No release published as the tag {{ steps.tag.outputs.tag }} already exists"
      if: steps.tag.outputs.tag-created == 'false'
